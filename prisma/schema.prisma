generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id       Int     @id @default(autoincrement())
  email    String  @unique
  password String
  name     String
  role     String  @default("client")

  // --- ВЕРНУЛ ПОТЕРЯННЫЕ ПОЛЯ (чтобы не было ошибки Data Loss) ---
  birthDate DateTime?
  height    Float?
  gender    String?
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  // -------------------------------------------------------------
  
  isTraining Boolean @default(false)

  // --- НОВОЕ: Связь Тренер-Клиент ---
  trainerId Int?
  trainer   User?    @relation("TrainerToClients", fields: [trainerId], references: [id])
  clients   User[]   @relation("TrainerToClients")
  // ----------------------------------

  // Связи с другими таблицами
  logs          WorkoutLog[]
  plans         PlannedWorkout[]
  measurements  Measurement[]
  programs      Program[]
}

model Measurement {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  date      DateTime @default(now())
  
  weight    Float    
  height    Float?
  neck      Float?   
  waist     Float?   
  hips      Float?
  bodyFat   Float?   
  calories  Int?     
}

model Program {
  id                Int      @id @default(autoincrement())
  userId            Int
  user              User     @relation(fields: [userId], references: [id])
  name              String   
  splitType         String   
  periodizationType String   
  exercises         String   
}

model WorkoutLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  date      DateTime @default(now())
  details   String   
  isDone    Boolean  @default(false)
}

model PlannedWorkout {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  
  name      String   
  order     Int      
  exercises String   
  
  isDone    Boolean  @default(false)
  date      DateTime?
}

// Таблица для твоих личных шаблонов
model Template {
  id        Int      @id @default(autoincrement())
  name      String   
  workouts  String   
  createdAt DateTime @default(now())
}

model Exercise {
  id    Int    @id @default(autoincrement())
  name  String @unique 
}